<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>CTF Crossword — Gold Glow on JEFFERSON (Complete)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{ --size:32px; --gap:2px; --bg:#0a0a0f; --ink:#e7e9ee; --accent:#00ff9f; --block:#000; --cell:#fff; --border:#2c3443; }
*{box-sizing:border-box}
body{margin:0; padding:24px; background:var(--bg); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;}
h1{font-size:20px;margin:0 0 12px}
.wrapper{display:grid; grid-template-columns: 1fr 320px; gap:24px; align-items:start;}
@media (max-width:900px){ .wrapper{grid-template-columns:1fr;} }
.grid{display:grid; gap: var(--gap); width: fit-content; border:1px solid var(--border); padding: var(--gap); background:#0f1118; border-radius:10px; box-shadow: 0 0 0 1px rgba(255,255,255,0.03) inset, 0 20px 50px rgba(0,0,0,0.4);}
.cell{width:var(--size); height:var(--size); background:var(--cell); position:relative; border-radius:6px; overflow:hidden; display:flex; align-items:center; justify-content:center; box-shadow: inset 0 0 0 1px #cfd3dc;}
.cell.block{ background:var(--block); box-shadow: inset 0 0 0 1px #000; }
.cell input{width:100%; height:100%; background: transparent; color:#000; text-transform: uppercase; font-weight:800; font-size:16px; text-align:center; border:none; outline:none; border-radius:6px; caret-color: var(--accent);}
.cell input:focus{ box-shadow: inset 0 0 0 2px rgba(0,255,159,0.45);}
.num{position:absolute; top:2px; left:4px; font-size:10px; color:#111; font-weight:700; pointer-events:none;}
.controls{display:flex; gap:12px; align-items:center; margin:8px 0 16px}
.buttons button{ background:#141821; color:#e9f0ff; border:1px solid #2c3443; padding:8px 12px; border-radius:8px; cursor:pointer; }
.buttons button:hover{ border-color: var(--accent); }
.panel{position:sticky; top:16px; border:1px solid #2a2f3a; border-radius:10px; padding:12px; background:#0f1118; box-shadow: 0 0 0 1px rgba(255,255,255,0.03) inset;}
.panel h2{font-size:16px;margin:0 0 8px}
.panel h3{font-size:14px;margin:12px 0 6px; color:#c3c8d6}
.clues{display:flex; flex-direction:column; gap:6px;}
.clue{padding:6px 8px; border:1px solid transparent; border-radius:8px; cursor:pointer; line-height:1.2}
.clue:hover{ border-color:#2c3443; background:#111522; }
.clue.active{ border-color: var(--accent); background: rgba(0,255,159,0.08);}
.highlight input{ box-shadow: inset 0 0 0 2px rgba(0,255,159,0.65) !important;}

/* Gold glow when the puzzle is fully correct */
.cell.gold {
  box-shadow: 0 0 0 2px #ffcc33, 0 0 14px #ffcc33 !important;
}
.cell.gold input {
  background: #fff6d5 !important;
  box-shadow: inset 0 0 0 2px #ffcc33 !important;
}
</style>
</head>
<body>
  <h1>CTF Crossword — Gold Glow on JEFFERSON (Complete)</h1>
  <div class="controls">
    <div class="buttons">
      <button id="btn-clear">Clear</button>
      <button id="btn-check">Check</button>
      <button id="btn-save">Export Progress</button>
      <button id="btn-load">Import Progress</button>
    </div>
  </div>

  <div class="wrapper">
    <div id="grid" class="grid"></div>
    <aside class="panel">
      <h2>Clues</h2>
      <h3>Across</h3>
      <div id="across" class="clues"></div>
      <h3>Down</h3>
      <div id="down" class="clues"></div>
    </aside>
  </div>

<script>
/* =======================
   PASTE YOUR DATA HERE
   =======================

   Replace the arrays below with the ones from your working file.
   Keep the same names (GRID, ROWS, COLS, NUMBERS, ACROSS, DOWN).
*/

// ====== BEGIN: PASTE FROM YOUR FILE ======
const GRID = /* PASTE your GRID array here (array of rows x cols with {blocked, solution}) */ [];
const ROWS = /* PASTE your ROWS number here */ 0;
const COLS = /* PASTE your COLS number here */ 0;
const NUMBERS = /* PASTE your NUMBERS matrix here (rows x cols of "" or number strings) */ [];

const ACROSS = /* PASTE your numbered Across entries here (array of {num, cells:[[r,c],...], answer}) */ [];
const DOWN   = /* PASTE your numbered Down entries here (array of {num, cells:[[r,c],...], answer}) */ [];

const CLUES = /* OPTIONAL: paste your clue map if you have it */ {};
// ====== END: PASTE FROM YOUR FILE ======


// ====== RENDERING LOGIC (unchanged layout) ======
const gridEl = document.getElementById('grid');
gridEl.style.gridTemplateColumns = `repeat(${COLS}, var(--size))`;

function idFor(r,c){ return `r${r}c${c}`; }
function isLetter(r,c){ return r>=0 && r<ROWS && c>=0 && c<COLS && !GRID[r][c].blocked; }

function buildGrid(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const cell = GRID[r][c];
      const div = document.createElement('div');
      div.className = 'cell' + (cell.blocked ? ' block' : '');
      if(!cell.blocked){
        const n = (NUMBERS[r] && NUMBERS[r][c]) ? NUMBERS[r][c] : "";
        if(n){
          const num = document.createElement('div');
          num.className = 'num';
          num.textContent = n;
          div.appendChild(num);
        }
        const inp = document.createElement('input');
        inp.maxLength = 1; inp.value = "";
        inp.dataset.r = r; inp.dataset.c = c; inp.id = idFor(r,c);
        inp.addEventListener('input', (e)=>{
          e.target.value = e.target.value.toUpperCase().replace(/[^A-Z]/g,'');
        });
        inp.addEventListener('keydown', (e)=>{
          if(e.key === 'ArrowLeft'){ e.preventDefault(); move(r,c,0,-1); }
          else if(e.key === 'ArrowRight'){ e.preventDefault(); move(r,c,0,1); }
          else if(e.key === 'ArrowUp'){ e.preventDefault(); move(r,c,-1,0); }
          else if(e.key === 'ArrowDown'){ e.preventDefault(); move(r,c,1,0); }
          else if(e.key === 'Backspace'){
            if(!e.target.value){ e.preventDefault(); move(r,c,0,-1,true); }
            else { e.target.value=''; e.preventDefault(); }
          }
        });
        div.appendChild(inp);
      }
      gridEl.appendChild(div);
    }
  }
}

function move(r,c,dr,dc,clearPrev=false){
  let nr=r, nc=c;
  while(true){
    nr += dr; nc += dc;
    if(nr<0||nc<0||nr>=ROWS||nc>=COLS) return;
    if(!GRID[nr][nc].blocked){
      const el = document.getElementById(idFor(nr,nc));
      if(el){
        el.focus();
        if(clearPrev) el.value='';
      }
      return;
    }
  }
}

// Optional clue panel (if CLUES provided)
function renderClues(){
  const acrossEl = document.getElementById('across');
  const downEl = document.getElementById('down');
  const mk = (e)=>`${e.num}. ${(CLUES[e.answer]||('Clue for '+e.answer))} (${e.cells.length})`;
  (ACROSS||[]).slice().sort((a,b)=>a.num-b.num).forEach(e=>{
    const d=document.createElement('div'); d.className='clue'; d.textContent=mk(e);
    d.onclick=()=>highlight(e); acrossEl.appendChild(d);
  });
  (DOWN||[]).slice().sort((a,b)=>a.num-b.num).forEach(e=>{
    const d=document.createElement('div'); d.className='clue'; d.textContent=mk(e);
    d.onclick=()=>highlight(e); downEl.appendChild(d);
  });
}
function highlight(entry){
  document.querySelectorAll('.cell').forEach(x=>x.classList.remove('highlight'));
  entry.cells.forEach(([r,c])=>{
    const el = document.getElementById(idFor(r,c));
    if(el) el.parentElement.classList.add('highlight');
  });
  if(entry.cells.length){
    const [r,c] = entry.cells[0];
    const el = document.getElementById(idFor(r,c));
    if(el) el.focus();
  }
}

document.getElementById('btn-clear').onclick = ()=>{ document.querySelectorAll('.cell input').forEach(i=> i.value=''); };
document.getElementById('btn-check').onclick = ()=>{ setTimeout(checkAndGlow, 0); };
document.getElementById('btn-save').onclick = ()=>{
  const data=[];
  document.querySelectorAll('.cell input').forEach(inp=>{
    data.push({r:+inp.dataset.r, c:+inp.dataset.c, v:(inp.value||'').toUpperCase()});
  });
  const blob = new Blob([JSON.stringify({rows:ROWS, cols:COLS, data}, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'crossword_progress.json'; a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('btn-load').onclick = ()=>{
  const inp = document.createElement('input');
  inp.type = 'file'; inp.accept = 'application/json';
  inp.addEventListener('change', ()=>{
    const f = inp.files[0];
    const reader = new FileReader();
    reader.onload = ()=>{
      try{
        const obj = JSON.parse(reader.result);
        obj.data.forEach(o=>{
          const el = document.getElementById(idFor(o.r,o.c));
          if(el) el.value = (o.v||'').toUpperCase();
        });
        setTimeout(checkAndGlow, 0);
      }catch(err){ alert('Import failed: ' + err.message); }
    };
    reader.readAsText(f);
  });
  inp.click();
};

// ====== GOLD GLOW FOR JEFFERSON WHEN PUZZLE COMPLETE ======
function isPuzzleComplete(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const cell = GRID[r][c];
      if(!cell.blocked){
        const want = (cell.solution||'').toUpperCase();
        const el = document.getElementById(idFor(r,c));
        const got = (el && el.value ? el.value.toUpperCase() : '');
        if(got !== want) return false;
      }
    }
  }
  return true;
}

function getJeffersonCells(){
  const entries = [];
  if (Array.isArray(ACROSS)) entries.push(...ACROSS);
  if (Array.isArray(DOWN))   entries.push(...DOWN);
  for(const e of entries){
    if((e.answer||'').toUpperCase() === 'JEFFERSON'){
      return Array.isArray(e.cells) ? e.cells : [];
    }
  }
  // Fallback: vertical scan for "JEFFERSON"
  const target = 'JEFFERSON';
  for(let c=0;c<COLS;c++){
    for(let r=0;r<ROWS;r++){
      if(r>0 && !GRID[r-1][c].blocked) continue; // require true start above
      let ok=true, cells=[];
      for(let i=0;i<target.length;i++){
        const rr=r+i;
        if(rr>=ROWS || GRID[rr][c].blocked ||
           (GRID[rr][c].solution||'').toUpperCase()!==target[i]){ ok=false; break; }
        cells.push([rr,c]);
      }
      if(ok) return cells;
    }
  }
  return [];
}
const JEFF_CELLS = getJeffersonCells();

function setGold(on){
  JEFF_CELLS.forEach(([r,c])=>{
    const el = document.getElementById(idFor(r,c));
    if(!el) return;
    const tile = el.parentElement;
    if(!tile) return;
    if(on) tile.classList.add('gold'); else tile.classList.remove('gold');
  });
}

function checkAndGlow(){
  setGold(isPuzzleComplete());
}

// Keep glow in sync while typing
document.addEventListener('input', function(e){
  if(e.target && e.target.tagName === 'INPUT'){
    setTimeout(checkAndGlow, 0);
  }
}, true);

// Build everything
buildGrid();
renderClues();
</script>
</body>
</html>
